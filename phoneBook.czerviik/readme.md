# Console PhoneBook Project

## Introduction

Console-based CRUD application where users can manage Contacts and their Phone
Numbers, send e-mails through Gmail, and inspect SQL queries generated by
Entity Framework Core.  
Developed using **C# (.NET 9)** and **SQL Server**.

* Please read the Setup instructions lower in the file before start.

* <https://www.thecsharpacademy.com/project/16/phonebook>

## Given Requirements

* Record contacts with their phone numbers.
* Users should be able to Add, Delete, Update and Read from a SQL Server
database using the console.
* Must use **Entity Framework Core** (Code-First approach).
* A base Contact class must contain at least **Name**, **Email**, and
**Phone Number** properties.
* Validate e-mails and phone numbers and inform the user about expected
formats.
* Handle errors so the app doesn’t crash unexpectedly if EF or the database
encounters problems.
* Seed data using Entity Framework so the user has some contacts to start
with.
* Must use **SQL Server**, not SQLite.

## Given Challenges

* For each database interaction, print the corresponding SQL query generated
by Entity Framework.
* Add functionality to send an e-mail message to a contact directly from
the app.
* Expand the app by creating categories of contacts (Family, Friends, Work,
etc.).
* Extend the idea further — what if you wanted to send not only e-mails but
 SMS?

---

## Features

### SQL Server + Entity Framework Core

* The program uses **SQL Server** as the main database.
* Code-First migrations are used — Entity Framework automatically creates
and manages the schema.
* Tables:
  * `Contacts` – stores name, email, category, timestamps.
  * `PhoneNumbers` – linked to contacts through a one-to-many relationship.
* Includes **data seeding** using EF migrations (10 predefined contacts
with default phone numbers).
* Please adjust the creation and modification timedate manually modifying
the `seedDate` variable, it's static.

### Gmail Integration (OAuth 2.0)

* The user can send emails directly from the console application.
* Uses Google's **OAuth 2.0 API** through the `GoogleAuthService` and
 `GmailSender` classes.
* Requires creating a Google Cloud API project and downloading
`credentials.json`.
* The first time you send an email, you’ll be asked to authenticate
via a browser window.
* The token is stored locally for future use.

### Developer Mode (EF SQL Logging)

* You can turn Developer Mode **on/off** from the **Main Menu**.
* When enabled, all executed EF SQL commands are logged to
a file named  
  `ef-sql.log` in the application directory.
* The header of the console shows `DEV MODE` with the log file
path when active.
<img width="196" height="144" alt="Screenshot 2025-11-09 at 23 06 45" src="https://github.com/user-attachments/assets/0aee569f-8940-40ee-b3a2-322cbc7eeed8" />

### Console UI (Spectre.Console)

* The application uses the **Spectre.Console** library to render
* Contacts are displayed in a paginated table view.
* Pagination “remembers” your page position until you return to the Main Menu.
* You can adjust the number of rows per page by changing the `MAX_ROWS`
constant in `UserInterface.cs`.

<img width="451" height="154" alt="Screenshot 2025-11-09 at 23 09 42" src="https://github.com/user-attachments/assets/40e0885b-4c8d-4fad-81f2-930f10856b59" />

### Managing Contacts

Users can:

* Add, edit, delete, or view contacts.
* Assign one or more phone numbers per contact (each with optional “default”
status).
* Validate e-mail and phone number formats interactively.
* Automatically handle timestamps for creation and modification.

### Error Handling

* Basic error-handling layer prevents application crashes.
* Database or network issues are caught and logged while in dev mode.
* Input validation ensures invalid formats don’t reach the database.

---

## Setup Instructions

### 1. Configure SQL Server Connection

* Edit `appsettings.json` to include your connection string.
* I was forced to use Docker with SQL Server running in it as I use
Mac for coding.

### 2. Apply Migrations and Seed Data

* To create the database and apply migrations (including seed data):
  * `dotnet ef migrations add InitialCreate`
  * `dotnet ef database update`
* This willl:
  * Create all required tables.
  * Insert 10 sample contacts and their phone numbers.

### 3. Gmail API Setup

1. Go to <https://console.cloud.google.com/>
2. Create a new Google Cloud Project.
3. Enable the Gmail API.
4. Create OAuth 2.0 credentials → Download `credentials.json`.
5. Place `credentials.json` in the app’s root directory (where
`Program.cs` is located).
7. The first time you send an e-mail, you’ll be prompted to sign
in via browser.

## Lessons Learned

* Learned to integrate **Google Gmail API** using OAuth 2.0 with C#.
* Gained basic understanding of **Entity Framework Code-First**:
  * Creating and managing migrations.
  * Setting up one-to-many relationships.
  * Seeding data with static values (why dynamic values like
  `DateTime.UtcNow` break migrations).
  * Updating and syncing models with existing databases.
* Learned to troubleshoot EF exceptions, context lifetime, and
entity tracking.
* Appreciated how EF differs from traditional **Oracle SQL** which
I'm using in my job.
* Understood better error handling for database-driven console
applications.
* Improved structuring of console UI with **Spectre.Console** (menus,
tables, and pagination).
